function resmap_fixDisplayInTabs(o,e){function t(){null!=i&&clearTimeout(i),i=o.is(":hidden")?setTimeout(t,r):setTimeout(function(){n()},r)}function n(){if(null!=i&&clearTimeout(i),data=o.data("gmap"),data){var t=data.gmap;google.maps.event.trigger(t,"resize"),o.gMapResp("fixAfterResize"),e&&0!=data.markers.length&&google.maps.event.trigger(data.markers[0],"click")}}var i=null,r=100;o.is(":hidden")?t():i=setTimeout(function(){t()},3*r)}!function(o){var e=function(){this.markers=[],this.mainMarker=!1,this.icon="http://www.google.com/mapfiles/marker.png"};e.prototype.dist=function(o){return Math.sqrt(Math.pow(this.markers[0].latitude-o.latitude,2)+Math.pow(this.markers[0].longitude-o.longitude,2))},e.prototype.setIcon=function(o){this.icon=o},e.prototype.addMarker=function(o){this.markers[this.markers.length]=o},e.prototype.getMarker=function(){if(this.mainmarker)return this.mainmarker;var o,e;return 1<this.markers.length?(o=new t.MarkerImage("http://thydzik.com/thydzikGoogleMap/markerlink.php?text="+this.markers.length+"&color=EF9D3F"),e="cluster of "+this.markers.length+" markers"):(o=new t.MarkerImage(this.icon),e=this.markers[0].title),this.mainmarker=new t.Marker({position:new t.LatLng(this.markers[0].latitude,this.markers[0].longitude),icon:o,title:e,map:null})};var t=google.maps,n=new t.Geocoder,i=0,r=0,a={},a={init:function(e){var n,i=o.extend({},o.fn.gMapResp.defaults,e);for(n in o.fn.gMapResp.defaults.icon)i.icon[n]||(i.icon[n]=o.fn.gMapResp.defaults.icon[n]);return this.each(function(){var e=o(this),n=a._getMapCenter.apply(e,[i]);"fit"==i.zoom&&(i.zoomFit=!0,i.zoom=a._autoZoom.apply(e,[i]));var r={zoom:i.zoom,center:n,mapTypeControl:i.mapTypeControl,mapTypeControlOptions:{},zoomControl:i.zoomControl,draggable:i.draggable,zoomControlOptions:{},panControl:i.panControl,panControlOptions:{},scaleControl:i.scaleControl,scaleControlOptions:{},streetViewControl:i.streetViewControl,streetViewControlOptions:{},mapTypeId:i.maptype,scrollwheel:i.scrollwheel,maxZoom:i.maxZoom,minZoom:i.minZoom};if(i.controlsPositions.mapType&&(r.mapTypeControlOptions.position=i.controlsPositions.mapType),i.controlsPositions.zoom&&(r.zoomControlOptions.position=i.controlsPositions.zoom),i.controlsPositions.pan&&(r.panControlOptions.position=i.controlsPositions.pan),i.controlsPositions.scale&&(r.scaleControlOptions.position=i.controlsPositions.scale),i.controlsPositions.streetView&&(r.streetViewControlOptions.position=i.controlsPositions.streetView),i.styles&&(r.styles=i.styles),r.mapTypeControlOptions.style=i.controlsStyle.mapType,r.zoomControlOptions.style=i.controlsStyle.zoom,r=new t.Map(this,r),i.log&&console.log("map center is:"),i.log&&console.log(n),e.data("$gmap",r),e.data("gmap",{opts:i,gmap:r,markers:[],markerKeys:{},infoWindow:null,clusters:[]}),0!==i.controls.length)for(n=0;n<i.controls.length;n+=1)r.controls[i.controls[n].pos].push(i.controls[n].div);i.clustering.enabled?(n=e.data("gmap"),n.markers=i.markers,a._renderCluster.apply(e,[]),t.event.addListener(r,"bounds_changed",function(){a._renderCluster.apply(e,[])})):0!==i.markers.length&&a.addMarkers.apply(e,[i.markers]),a._onComplete.apply(e,[])})},_delayedMode:!1,_onComplete:function(){var o=this.data("gmap"),e=this;if(0!==i)window.setTimeout(function(){a._onComplete.apply(e,[])},100);else{if(a._delayedMode){var t=a._getMapCenter.apply(this,[o.opts,!0]);a._setMapCenter.apply(this,[t]),o.opts.zoomFit&&(t=a._autoZoom.apply(this,[o.opts,!0]),o.gmap.setZoom(t))}o.opts.onComplete()}},_setMapCenter:function(o){var e=this.data("gmap");if(e&&e.opts.log&&console.log("delayed setMapCenter called"),e&&void 0!==e.gmap&&0==i)e.gmap.setCenter(o);else{var t=this;window.setTimeout(function(){a._setMapCenter.apply(t,[o])},100)}},_boundaries:null,_getBoundaries:function(o){var e,t=o.markers,n=1e3,i=-1e3,r=1e3,s=-1e3;if(t){for(e=0;e<t.length;e+=1)t[e].latitude&&t[e].longitude&&(n>t[e].latitude&&(n=t[e].latitude),i<t[e].longitude&&(i=t[e].longitude),r>t[e].longitude&&(r=t[e].longitude),s<t[e].latitude&&(s=t[e].latitude),o.log&&console.log(t[e].latitude,t[e].longitude,n,i,r,s));a._boundaries={N:n,E:i,W:r,S:s}}return-1e3==n&&(a._boundaries={N:0,E:0,W:0,S:0}),a._boundaries},_getBoundariesFromMarkers:function(){var o,e=this.data("gmap").markers,t=1e3,n=-1e3,i=1e3,r=-1e3;if(e){for(o=0;o<e.length;o+=1)t>e[o].getPosition().lat()&&(t=e[o].getPosition().lat()),n<e[o].getPosition().lng()&&(n=e[o].getPosition().lng()),i>e[o].getPosition().lng()&&(i=e[o].getPosition().lng()),r<e[o].getPosition().lat()&&(r=e[o].getPosition().lat());a._boundaries={N:t,E:n,W:i,S:r}}return-1e3==t&&(a._boundaries={N:0,E:0,W:0,S:0}),a._boundaries},_getMapCenter:function(o,e){var i,r,s,l=this;if(o.markers.length&&("fit"==o.latitude||"fit"==o.longitude))return r=e?a._getBoundariesFromMarkers.apply(this):a._getBoundaries(o),i=new t.LatLng((r.N+r.S)/2,(r.E+r.W)/2),o.log&&console.log(e,r,i),i;if(o.latitude&&o.longitude)return i=new t.LatLng(o.latitude,o.longitude);if(i=new t.LatLng(37.10516411731325,-95.73597945520021),o.address)return n.geocode({address:o.address},function(e,t){t===google.maps.GeocoderStatus.OK?a._setMapCenter.apply(l,[e[0].geometry.location]):o.log&&console.log("Geocode was not successful for the following reason: "+t)}),i;if(0<o.markers.length){for(s=null,r=0;r<o.markers.length;r+=1)if(o.markers[r].setCenter){s=o.markers[r];break}if(null===s)for(r=0;r<o.markers.length;r+=1){if(o.markers[r].latitude&&o.markers[r].longitude){s=o.markers[r];break}o.markers[r].address&&(s=o.markers[r])}if(null===s)return i;if(s.latitude&&s.longitude)return new t.LatLng(s.latitude,s.longitude);s.address&&n.geocode({address:s.address},function(e,t){t===google.maps.GeocoderStatus.OK?a._setMapCenter.apply(l,[e[0].geometry.location]):o.log&&console.log("Geocode was not successful for the following reason: "+t)})}return i},_renderCluster:function(){var o,t=this.data("gmap"),n=t.markers,i=t.clusters,r=t.opts;for(o=0;o<i.length;o+=1)i[o].getMarker().setMap(null);if(i.length=0,o=t.gmap.getBounds()){var s=o.getNorthEast(),l=o.getSouthWest(),d=[],p=(s.lat()-l.lat())*r.clustering.clusterSize/100;for(o=0;o<n.length;o+=1)n[o].latitude<s.lat()&&n[o].latitude>l.lat()&&n[o].longitude<s.lng()&&n[o].longitude>l.lng()&&(d[d.length]=n[o]);for(r.log&&console.log("number of markers "+d.length+"/"+n.length),r.log&&console.log("cluster radius: "+p),o=0;o<d.length;o+=1){for(s=-1,n=0;n<i.length&&(l=i[n].dist(d[o]),!(p>l&&(s=n,r.clustering.fastClustering)));n+=1);-1===s?(n=new e,n.addMarker(d[o]),i[i.length]=n):i[s].addMarker(d[o])}for(r.log&&console.log("Total clusters in viewport: "+i.length),n=0;n<i.length;n+=1)i[n].getMarker().setMap(t.gmap)}else{var c=this;window.setTimeout(function(){a._renderCluster.apply(c)},1e3)}},_processMarker:function(o,e,n,i){var r,a=this.data("gmap"),s=a.gmap,l=a.opts;if(void 0===i&&(i=new t.LatLng(o.latitude,o.longitude)),!e){var d={image:l.icon.image,iconSize:new t.Size(l.icon.iconsize[0],l.icon.iconsize[1]),iconAnchor:new t.Point(l.icon.iconanchor[0],l.icon.iconanchor[1]),infoWindowAnchor:new t.Size(l.icon.infowindowanchor[0],l.icon.infowindowanchor[1])};e=new t.MarkerImage(d.image)}n||(new t.Size(l.icon.shadowsize[0],l.icon.shadowsize[1]),d&&d.iconAnchor||new t.Point(l.icon.iconanchor[0],l.icon.iconanchor[1])),e={position:i,icon:e,title:o.title,map:null,draggable:!0===o.draggable?!0:!1},l.clustering.enabled||(e.map=s),r=new t.Marker(e),r.setShadow(n),a.markers.push(r),o.key&&(a.markerKeys[o.key]=r);var p;o.html&&(n={content:"string"==typeof o.html?l.html_prepend+o.html+l.html_append:o.html,pixelOffset:o.infoWindowAnchor},l.log&&console.log("setup popup with data"),l.log&&console.log(n),p=new t.InfoWindow(n),t.event.addListener(r,"click",function(){l.log&&console.log("opening popup "+o.html),l.singleInfoWindow&&a.infoWindow&&a.infoWindow.close(),p.open(s,r),a.infoWindow=p})),o.html&&o.popup&&(l.log&&console.log("opening popup "+o.html),p.open(s,r),a.infoWindow=p),o.onDragEnd&&t.event.addListener(r,"dragend",function(e){l.log&&console.log("drag end"),o.onDragEnd(e)})},_geocodeMarker:function(o,e,s){var l=this;n.geocode({address:o.address},function(n,d){d===t.GeocoderStatus.OK?(i-=1,l.data("gmap").opts.log&&console.log("Geocode was successful with point: ",n[0].geometry.location),a._processMarker.apply(l,[o,e,s,n[0].geometry.location])):(d===t.GeocoderStatus.OVER_QUERY_LIMIT&&(!l.data("gmap").opts.noAlerts&&0===r&&alert("Error: too many geocoded addresses! Switching to 1 marker/s mode."),r+=1e3,window.setTimeout(function(){a._geocodeMarker.apply(l,[o,e,s])},r)),l.data("gmap").opts.log&&console.log("Geocode was not successful for the following reason: "+d))})},_autoZoom:function(e,t){var n,i,r=o(this).data("gmap"),s=o.extend({},r?r.opts:{},e),r=39135.758482;for(s.log&&console.log("autozooming map"),n=t?a._getBoundariesFromMarkers.apply(this):a._getBoundaries(s),s=111e3*(n.E-n.W)/this.width(),i=111e3*(n.S-n.N)/this.height(),n=2;20>n&&!(s>r||i>r);n+=1)r/=2;return n-2},addMarkers:function(o){var e=this.data("gmap").opts;if(0!==o.length)for(e.log&&console.log("adding "+o.length+" markers"),e=0;e<o.length;e+=1)a.addMarker.apply(this,[o[e]])},addMarker:function(o){var e=this.data("gmap").opts;e.log&&console.log("putting marker at "+o.latitude+", "+o.longitude+" with address "+o.address+" and html "+o.html);var n=e.icon.image,r=new t.Size(e.icon.iconsize[0],e.icon.iconsize[1]),s=new t.Point(e.icon.iconanchor[0],e.icon.iconanchor[1]),l=new t.Size(e.icon.infowindowanchor[0],e.icon.infowindowanchor[1]),d=e.icon.shadow,p=new t.Size(e.icon.shadowsize[0],e.icon.shadowsize[1]),c=new t.Point(e.icon.shadowanchor[0],e.icon.shadowanchor[1]);o.infoWindowAnchor=l,o.icon&&(o.icon.image&&(n=o.icon.image),o.icon.iconsize&&(r=new t.Size(o.icon.iconsize[0],o.icon.iconsize[1])),o.icon.iconanchor&&(s=new t.Point(o.icon.iconanchor[0],o.icon.iconanchor[1])),o.icon.infowindowanchor&&new t.Size(o.icon.infowindowanchor[0],o.icon.infowindowanchor[1]),o.icon.shadow&&(d=o.icon.shadow),o.icon.shadowsize&&(p=new t.Size(o.icon.shadowsize[0],o.icon.shadowsize[1])),o.icon.shadowanchor&&(c=new t.Point(o.icon.shadowanchor[0],o.icon.shadowanchor[1]))),n=new t.MarkerImage(n),d=new t.MarkerImage(d),o.address?("_address"===o.html&&(o.html=o.address),"_address"==o.title&&(o.title=o.address),e.log&&console.log("geocoding marker: "+o.address),i+=1,a._delayedMode=!0,a._geocodeMarker.apply(this,[o,n,d])):("_latlng"===o.html&&(o.html=o.latitude+", "+o.longitude),"_latlng"==o.title&&(o.title=o.latitude+", "+o.longitude),e=new t.LatLng(o.latitude,o.longitude),a._processMarker.apply(this,[o,n,d,e]))},removeAllMarkers:function(){var o,e=this.data("gmap").markers;for(o=0;o<e.length;o+=1)e[o].setMap(null),delete e[o];e.length=0},getMarker:function(o){return this.data("gmap").markerKeys[o]},fixAfterResize:function(o){var e=this.data("gmap");t.event.trigger(e.gmap,"resize"),o&&e.gmap.panTo(new google.maps.LatLng(0,0)),e.gmap.panTo(this.gMapResp("_getMapCenter",e.opts))},setZoom:function(o,e,t){var n=this.data("gmap").gmap;"fit"===o&&(o=a._autoZoom.apply(this,[e,t])),n.setZoom(parseInt(o))},changeSettings:function(o){var e,t=this.data("gmap"),n=[];for(e=0;e<t.markers.length;e+=1)n[e]={latitude:t.markers[e].getPosition().lat(),longitude:t.markers[e].getPosition().lng()};o.markers=n,o.zoom&&a.setZoom.apply(this,[o.zoom,o]),(o.latitude||o.longitude)&&t.gmap.panTo(a._getMapCenter.apply(this,[o]))},mapclick:function(o){google.maps.event.addListener(this.data("gmap").gmap,"click",function(e){o(e.latLng)})},geocode:function(o,e,i){n.geocode({address:o},function(o,n){n===t.GeocoderStatus.OK?e(o[0].geometry.location):i&&i(o,n)})},getRoute:function(e){var n=this.data("gmap"),i=n.gmap,r=new t.DirectionsRenderer,a=new t.DirectionsService,s={BYCAR:t.DirectionsTravelMode.DRIVING,BYBICYCLE:t.DirectionsTravelMode.BICYCLING,BYFOOT:t.DirectionsTravelMode.WALKING},l={MILES:t.DirectionsUnitSystem.IMPERIAL,KM:t.DirectionsUnitSystem.METRIC},d=null,p=null,c=null;return void 0!==e.routeDisplay?d=e.routeDisplay instanceof jQuery?e.routeDisplay[0]:"string"==typeof e.routeDisplay?o(e.routeDisplay)[0]:null:null!==n.opts.routeFinder.routeDisplay&&(d=n.opts.routeFinder.routeDisplay instanceof jQuery?n.opts.routeFinder.routeDisplay[0]:"string"==typeof n.opts.routeFinder.routeDisplay?o(n.opts.routeFinder.routeDisplay)[0]:null),r.setMap(i),null!==d&&r.setPanel(d),p=void 0!==s[n.opts.routeFinder.travelMode]?s[n.opts.routeFinder.travelMode]:s.BYCAR,c=void 0!==l[n.opts.routeFinder.travelUnit]?l[n.opts.routeFinder.travelUnit]:l.KM,a.route({origin:e.from,destination:e.to,travelMode:p,unitSystem:c},function(e,i){i==t.DirectionsStatus.OK?r.setDirections(e):null!==d&&o(d).html(n.opts.routeFinder.routeErrors[i])}),this}};o.fn.gMapResp=function(e){return a[e]?a[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void o.error("Method "+e+" does not exist on jQuery.gmap"):a.init.apply(this,arguments)},o.fn.gMapResp.defaults={log:!1,noAlerts:!0,address:"",latitude:null,longitude:null,zoom:3,maxZoom:null,minZoom:null,markers:[],controls:{},scrollwheel:!0,maptype:google.maps.MapTypeId.ROADMAP,mapTypeControl:!0,zoomControl:!0,draggable:!0,panControl:!1,scaleControl:!1,streetViewControl:!0,controlsPositions:{mapType:null,zoom:null,pan:null,scale:null,streetView:null},controlsStyle:{mapType:google.maps.MapTypeControlStyle.DEFAULT,zoom:google.maps.ZoomControlStyle.DEFAULT},singleInfoWindow:!0,html_prepend:'<div class="gmap_marker">',html_append:"</div>",icon:{image:"http://www.google.com/mapfiles/marker.png",iconsize:[20,34],iconanchor:[9,34],infowindowanchor:[0,0],shadow:"http://www.google.com/mapfiles/shadow50.png",shadowsize:[37,34],shadowanchor:[9,34]},onComplete:function(){},routeFinder:{travelMode:"BYCAR",travelUnit:"KM",routeDisplay:null,routeErrors:{INVALID_REQUEST:"The provided request is invalid.",NOT_FOUND:"One or more of the given addresses could not be found.",OVER_QUERY_LIMIT:"A temporary error occured. Please try again in a few minutes.",REQUEST_DENIED:"An error occured. Please contact us.",UNKNOWN_ERROR:"An unknown error occured. Please try again.",ZERO_RESULTS:"No route could be found within the given addresses."}},clustering:{enabled:!1,fastClustering:!1,clusterCount:10,clusterSize:40}}}(jQuery);